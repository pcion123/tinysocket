<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="650" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .layer-box { stroke-width: 3; rx: 12; ry: 12; }
      .app-layer { fill: #e6f3ff; stroke: #4a90e2; }
      .client-layer { fill: #f0e6ff; stroke: #8a2be2; }
      .component-layer { fill: #e6ffe6; stroke: #228b22; }
      .core-layer { fill: #fff0e6; stroke: #ff8c00; }
      .box { fill: #ffffff; stroke: #555; stroke-width: 1.5; rx: 6; ry: 6; }
      .text { font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif; text-anchor: middle; }
      .layer-title { font-size: 16px; font-weight: bold; fill: #2c3e50; }
      .component-title { font-size: 11px; font-weight: bold; fill: #2c3e50; }
      .component-desc { font-size: 9px; fill: #555; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .generic-text { font-size: 8px; fill: #999; font-style: italic; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="800" height="650" fill="#fafafa" stroke="#ddd" stroke-width="1"/>
  
  <!-- Title -->
  <text x="400" y="25" class="layer-title text" style="font-size: 20px; font-weight: bold;">ClientSocket 架構設計</text>
  
  <!-- Application Layer -->
  <g id="app-layer">
    <rect x="50" y="60" width="700" height="120" class="layer-box app-layer"/>
    <text x="400" y="50" class="layer-title text">Application Layer</text>
    <text x="720" y="50" class="component-desc text">應用設計</text>
    
    <!-- User Applications -->
    <rect x="100" y="90" width="150" height="60" class="box"/>
    <text x="175" y="115" class="component-title text">MyByteSocket</text>
    <text x="175" y="130" class="component-desc text">(User App)</text>
    
    <rect x="300" y="90" width="150" height="60" class="box"/>
    <text x="375" y="115" class="component-title text">MyJsonSocket</text>
    <text x="375" y="130" class="component-desc text">(User App)</text>
    
    <rect x="500" y="90" width="150" height="60" class="box"/>
    <text x="575" y="115" class="component-title text">GameClient</text>
    <text x="575" y="130" class="component-desc text">(User App)</text>
  </g>
  
  <!-- ClientSocket Framework Layer -->
  <g id="client-layer">
    <rect x="50" y="210" width="700" height="180" class="layer-box client-layer"/>
    <text x="400" y="200" class="layer-title text">ClientSocket Framework</text>
    
    <!-- ByteSocket -->
    <rect x="100" y="240" width="130" height="60" class="box"/>
    <text x="165" y="260" class="component-title text">ByteSocket</text>
    <text x="165" y="275" class="generic-text text">&lt;H, C&gt;</text>
    <text x="165" y="290" class="component-desc text">自動重連 心跳保持</text>
    
    <!-- JsonSocket -->
    <rect x="270" y="240" width="130" height="60" class="box"/>
    <text x="335" y="260" class="component-title text">JsonSocket</text>
    <text x="335" y="275" class="generic-text text">&lt;H, C&gt;</text>
    <text x="335" y="290" class="component-desc text">JSON 序列化</text>
    
    <!-- IClient Interface -->
    <rect x="440" y="240" width="130" height="60" class="box"/>
    <text x="505" y="260" class="component-title text">IClient</text>
    <text x="505" y="275" class="generic-text text">&lt;H, M, B&gt;</text>
    <text x="505" y="290" class="component-desc text">客戶端接口</text>
    
    <!-- Connector -->
    <rect x="600" y="240" width="120" height="60" class="box"/>
    <text x="660" y="260" class="component-title text">Connector</text>
    <text x="660" y="275" class="component-desc text">連接管理器</text>
    <text x="660" y="290" class="component-desc text">重連邏輯</text>
    
    <!-- SocketBase -->
    <rect x="200" y="330" width="300" height="40" class="box"/>
    <text x="350" y="345" class="component-title text">SocketBase&lt;H, M, B&gt;</text>
    <text x="350" y="360" class="component-desc text">(完整的泛型架構約束)</text>
  </g>
  
  <!-- Component Layer -->
  <g id="component-layer">
    <rect x="50" y="420" width="700" height="120" class="layer-box component-layer"/>
    <text x="400" y="410" class="layer-title text">Component Layer</text>
    
    <!-- ProtocolCatcher -->
    <rect x="100" y="450" width="150" height="60" class="box"/>
    <text x="175" y="475" class="component-title text">ProtocolCatcher</text>
    <text x="175" y="490" class="component-desc text">(協議異常捕獲)</text>
    
    <!-- AutoReconnect -->
    <rect x="280" y="450" width="150" height="60" class="box"/>
    <text x="355" y="475" class="component-title text">AutoReconnect</text>
    <text x="355" y="490" class="component-desc text">(智能重連機制)</text>
    
    <!-- Ping/Heartbeat -->
    <rect x="460" y="450" width="150" height="60" class="box"/>
    <text x="535" y="475" class="component-title text">Ping</text>
    <text x="535" y="490" class="component-desc text">(心跳保持機制)</text>
  </g>
  
  <!-- SocketIO Core Layer -->
  <g id="core-layer">
    <rect x="50" y="570" width="700" height="70" class="layer-box core-layer"/>
    <text x="400" y="560" class="layer-title text">SocketIO Core</text>
    <text x="400" y="600" class="component-desc text">ByteArrayBuffer, HeaderBase, MessageBase, SnowflakeUtil, ProfilerUtil</text>
    <text x="400" y="615" class="component-desc text">基於 Netty 4.1.115.Final 的高性能網絡通信核心</text>
  </g>
  
  <!-- Connection Arrows -->
  <g id="arrows">
    <!-- App to Framework -->
    <line x1="175" y1="150" x2="165" y2="240" class="arrow"/>
    <line x1="375" y1="150" x2="335" y2="240" class="arrow"/>
    <line x1="575" y1="150" x2="505" y2="240" class="arrow"/>
    
    <!-- Framework to SocketBase -->
    <line x1="165" y1="300" x2="280" y2="330" class="arrow"/>
    <line x1="335" y1="300" x2="350" y2="330" class="arrow"/>
    <line x1="505" y1="300" x2="420" y2="330" class="arrow"/>
    
    <!-- SocketBase to Components -->
    <line x1="280" y1="370" x2="175" y2="450" class="arrow"/>
    <line x1="350" y1="370" x2="355" y2="450" class="arrow"/>
    <line x1="420" y1="370" x2="535" y2="450" class="arrow"/>
    
    <!-- Components to Core -->
    <line x1="175" y1="510" x2="300" y2="570" class="arrow"/>
    <line x1="355" y1="510" x2="400" y2="570" class="arrow"/>
    <line x1="535" y1="510" x2="500" y2="570" class="arrow"/>
  </g>
</svg>

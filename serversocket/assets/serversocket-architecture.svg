<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="720" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .layer-box { stroke-width: 3; rx: 12; ry: 12; }
      .app-layer { fill: #e3f2fd; stroke: #1976d2; }
      .server-layer { fill: #f3e5f5; stroke: #7b1fa2; }
      .component-layer { fill: #e8f5e8; stroke: #388e3c; }
      .core-layer { fill: #fff3e0; stroke: #f57c00; }
      .box { fill: #ffffff; stroke: #555; stroke-width: 1.5; rx: 6; ry: 6; }
      .text { font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif; text-anchor: middle; }
      .layer-title { font-size: 16px; font-weight: bold; fill: #2c3e50; }
      .component-title { font-size: 11px; font-weight: bold; fill: #2c3e50; }
      .component-desc { font-size: 9px; fill: #555; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .generic-text { font-size: 8px; fill: #999; font-style: italic; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="800" height="720" fill="#fafafa" stroke="#ddd" stroke-width="1"/>
  
  <!-- Title -->
  <text x="400" y="25" class="layer-title text" style="font-size: 20px; font-weight: bold;">ServerSocket 架構設計</text>
  
  <!-- Application Layer -->
  <g id="app-layer">
    <rect x="40" y="60" width="720" height="120" class="layer-box app-layer"/>
    <text x="400" y="50" class="layer-title text">Application Layer</text>
    <text x="720" y="50" class="component-desc text">應用設計</text>
    
    <!-- User Applications -->
    <rect x="80" y="90" width="180" height="70" class="box"/>
    <text x="170" y="120" class="component-title text">MyByteServer</text>
    <text x="170" y="135" class="component-desc text">(User App)</text>
    
    <rect x="310" y="90" width="180" height="70" class="box"/>
    <text x="400" y="120" class="component-title text">MyJsonServer</text>
    <text x="400" y="135" class="component-desc text">(User App)</text>
    
    <rect x="540" y="90" width="180" height="70" class="box"/>
    <text x="630" y="120" class="component-title text">GameServer</text>
    <text x="630" y="135" class="component-desc text">(User App)</text>
  </g>
  
  <!-- ServerSocket Framework Layer -->
  <g id="server-layer">
    <rect x="40" y="210" width="720" height="200" class="layer-box server-layer"/>
    <text x="400" y="200" class="layer-title text">ServerSocket Framework</text>
    
    <!-- ByteSocket -->
    <rect x="70" y="240" width="140" height="70" class="box"/>
    <text x="140" y="267" class="component-title text">ByteSocket</text>
    <text x="140" y="282" class="generic-text text">&lt;H, C&gt;</text>
    <text x="140" y="295" class="component-desc text">二進制服務器</text>
    
    <!-- JsonSocket -->
    <rect x="230" y="240" width="140" height="70" class="box"/>
    <text x="300" y="267" class="component-title text">JsonSocket</text>
    <text x="300" y="282" class="generic-text text">&lt;H, C&gt;</text>
    <text x="300" y="295" class="component-desc text">JSON 服務器</text>
    
    <!-- ByteConnection -->
    <rect x="450" y="240" width="140" height="70" class="box"/>
    <text x="520" y="262" class="component-title text">ByteConnection</text>
    <text x="520" y="275" class="component-desc text">二進制連接</text>
    <text x="520" y="288" class="component-desc text">狀態管理</text>
    
    <!-- JsonConnection -->
    <rect x="610" y="240" width="140" height="70" class="box"/>
    <text x="680" y="262" class="component-title text">JsonConnection</text>
    <text x="680" y="275" class="component-desc text">JSON 連接</text>
    <text x="680" y="288" class="component-desc text">自動序列化</text>
    
    <!-- SocketBase -->
    <rect x="170" y="340" width="360" height="50" class="box"/>
    <text x="350" y="360" class="component-title text">SocketBase&lt;H, C, M, B&gt;</text>
    <text x="350" y="375" class="component-desc text">(完整的泛型架構約束)</text>
  </g>
  
  <!-- Component Layer -->
  <g id="component-layer">
    <rect x="40" y="440" width="720" height="150" class="layer-box component-layer"/>
    <text x="400" y="430" class="layer-title text">Component Layer</text>
    
    <!-- RateLimiter -->
    <rect x="70" y="470" width="150" height="100" class="box"/>
    <text x="145" y="495" class="component-title text">RateLimiter</text>
    <text x="145" y="510" class="component-desc text">(限流器)</text>
    <text x="145" y="525" class="component-desc text">令牌桶算法</text>
    <text x="145" y="540" class="component-desc text">IP/用戶級限流</text>
    
    <!-- ProtocolCatcher -->
    <rect x="250" y="470" width="150" height="100" class="box"/>
    <text x="325" y="495" class="component-title text">ProtocolCatcher</text>
    <text x="325" y="510" class="component-desc text">(協議異常捕獲)</text>
    <text x="325" y="525" class="component-desc text">異常處理包裝</text>
    <text x="325" y="540" class="component-desc text">優雅降級處理</text>
    
    <!-- ProtocolRegister -->
    <rect x="430" y="470" width="150" height="100" class="box"/>
    <text x="505" y="495" class="component-title text">ProtocolRegister</text>
    <text x="505" y="510" class="component-desc text">(協議註冊器)</text>
    <text x="505" y="525" class="component-desc text">@ProtocolTag</text>
    <text x="505" y="540" class="component-desc text">註解掃描</text>
    
    <!-- CacheManager -->
    <rect x="610" y="470" width="150" height="100" class="box"/>
    <text x="685" y="495" class="component-title text">CacheManager</text>
    <text x="685" y="510" class="component-desc text">(快取管理器)</text>
    <text x="685" y="525" class="component-desc text">ByteCache</text>
    <text x="685" y="540" class="component-desc text">JsonCache</text>
  </g>
  
  <!-- SocketIO Core Layer -->
  <g id="core-layer">
    <rect x="40" y="620" width="720" height="90" class="layer-box core-layer"/>
    <text x="400" y="610" class="layer-title text">SocketIO Core</text>
    <text x="400" y="650" class="component-desc text">ByteArrayBuffer, JsonUtil, ProfilerUtil, SnowflakeUtil</text>
    <text x="400" y="665" class="component-desc text">基於 Netty 4.1.115.Final + FastJSON 2.0.52</text>
    <text x="400" y="680" class="component-desc text">高性能網絡通信核心 + JSON 序列化支援</text>
  </g>
  
  <!-- Connection Arrows -->
  <g id="arrows">
    <!-- App to Framework -->
    <line x1="170" y1="160" x2="140" y2="240" class="arrow"/>
    <line x1="400" y1="160" x2="300" y2="240" class="arrow"/>
    <line x1="630" y1="160" x2="520" y2="240" class="arrow"/>
    
    <!-- Framework to SocketBase -->
    <line x1="140" y1="310" x2="250" y2="340" class="arrow"/>
    <line x1="300" y1="310" x2="350" y2="340" class="arrow"/>
    <line x1="520" y1="310" x2="450" y2="340" class="arrow"/>
    <line x1="680" y1="310" x2="480" y2="340" class="arrow"/>
    
    <!-- SocketBase to Components -->
    <line x1="250" y1="390" x2="145" y2="470" class="arrow"/>
    <line x1="320" y1="390" x2="325" y2="470" class="arrow"/>
    <line x1="420" y1="390" x2="505" y2="470" class="arrow"/>
    <line x1="480" y1="390" x2="685" y2="470" class="arrow"/>
    
    <!-- Components to Core -->
    <line x1="145" y1="570" x2="300" y2="620" class="arrow"/>
    <line x1="325" y1="570" x2="380" y2="620" class="arrow"/>
    <line x1="505" y1="570" x2="420" y2="620" class="arrow"/>
    <line x1="685" y1="570" x2="500" y2="620" class="arrow"/>
  </g>
</svg>
